[
  {
    "name": "projection_simple",
    "category": "projection",
    "description": "Return company name and orgnr",
    "collection": "selskap",
    "complexity": 1,
    "pipeline": [
      { "$project": { "_id": 0, "navn": 1, "orgnr": 1 } }
    ]
  },
  {
    "name": "selection_simple",
    "category": "selection",
    "description": "Companies with a known organization type",
    "collection": "selskap",
    "complexity": 1,
    "pipeline": [
      { "$match": { "organisasjonstype": { "$exists": true, "$ne": null } } },
      { "$project": { "_id": 0, "navn": 1, "organisasjonstype": 1 } }
    ]
  },
  {
    "name": "join_owners_by_company",
    "category": "join",
    "description": "Join selskap with eierskap on company orgnr",
    "collection": "selskap",
    "complexity": 3,
    "pipeline": [
      {
        "$lookup": {
          "from": "eierskap",
          "localField": "orgnr",
          "foreignField": "company.orgnr",
          "as": "eierskap_info"
        }
      },
      { "$project": { "_id": 0, "navn": 1, "orgnr": 1, "eierskap_info": 1 } }
    ]
  },
  {
    "name": "join_owner_names",
    "category": "join",
    "description": "List owner names and year per company",
    "collection": "selskap",
    "complexity": 4,
    "pipeline": [
      {
        "$lookup": {
          "from": "eierskap",
          "localField": "orgnr",
          "foreignField": "company.orgnr",
          "as": "e"
        }
      },
      { "$unwind": "$e" },
      { "$project": { "_id": 0, "selskap": "$navn", "eiernavn": "$e.owner.navn", "år": "$e.year" } }
    ]
  },
  {
    "name": "union_owners_and_shareholders",
    "category": "union",
    "description": "Union of owners (eierskap) and shareholders (aksjeeiebok)",
    "collection": "eierskap",
    "complexity": 4,
    "pipeline": [
      { "$project": { "_id": 0, "navn": "$owner.navn", "kilde": { "$literal": "eierskap" } } },
      {
        "$unionWith": {
          "coll": "aksjeeiebok",
          "pipeline": [ { "$project": { "_id": 0, "navn": "$aksjonær.navn", "kilde": { "$literal": "aksjeeiebok" } } } ]
        }
      }
    ]
  },
  {
    "name": "intersection_politicians_owners",
    "category": "intersection",
    "description": "Politician names that also appear as owners",
    "collection": "politikere",
    "complexity": 4,
    "pipeline": [
      {
        "$lookup": {
          "from": "eierskap",
          "pipeline": [ { "$project": { "_id": 0, "navn": "$owner.navn" } } ],
          "as": "e"
        }
      },
      { "$match": { "$expr": { "$in": ["$navn", "$e.navn"] } } },
      { "$project": { "_id": 0, "navn": 1, "parti": 1 } }
    ]
  },
  {
    "name": "aggregation_companies_by_type",
    "category": "aggregation",
    "description": "Count companies per organization type",
    "collection": "selskap",
    "complexity": 2,
    "pipeline": [
      { "$group": { "_id": "$organisasjonstype", "antall": { "$sum": 1 } } },
      { "$sort": { "antall": -1 } }
    ]
  },
  {
    "name": "avg_ownership_per_year",
    "category": "aggregation",
    "description": "Average ownership share per year",
    "collection": "eierskap",
    "complexity": 3,
    "pipeline": [
      { "$group": { "_id": "$year", "avg_andel": { "$avg": "$andel" } } },
      { "$sort": { "_id": 1 } }
    ]
  }
]


SQL-spørringer for GroundTruth0



Finn navn og organisasjonnummer på selskaper som har gått konkurs, samt dato for oppløsningen
select navn, orgnr, oppløstDato
from konkurs


Finn navn på selskaper og deres aksjonærer, der aksjonærens navn inneholder 'EQUINOR'
select selskap, aksjonærNavn
from aksjeeiebok
where aksjonærNavn like '%EQUINOR%'


Finn navn på konkursselskaper og hvor lenge det eksisterte før oppløsning
select navn, oppløstdato-etablertdato as dager,
round((oppløstdato-etablertdato)/365.0,2) as år
from konkurs


Finn navn og organisasjonstype for selskap(ene) med kortest levetid
select navn, organisasjonstype, oppløstdato-etablertdato as dager
from konkurs
where oppløstdato-etablertdato = (select min(dager)
                                  from (select oppløstdato-etablertdato as dager from konkurs))


Finn navn som deles av minst 4 politikere samt deres respektive partier og hjemkommuner 
with 
p(navn,antall) as
(select navn, count(fødselsdato)
from politikere
group by navn
having count(*)>3)

select x.navn, x.fødselsdato, x.parti, x.kommune
from p, politikere x
where p.navn = x.navn
order by x.navn




## navn, fødselsdato og kommune for alle personer  (store bokstaver) samt navnet på tabellen de finnes i
with 
allepersoner(navn, fødselsdato, kommune, tabell) as
(
(select upper(navn), fødselsdato, upper(kommune),'politikere' from politikere where fødselsdato is not null)
union
(select upper(navn), fødselsdato, upper(kommunenavn),'person' from person where fødselsdato is not null)
union
(select upper(eierpersonnavn), eierpersonfødselsdato,upper(eierpersonkommune),'eierskap'
 from eierskap where eierpersonfødselsdato is not null)
 )
 
select navn, fødselsdato, kommune, tabell
from allepersoner
order by navn



Finn konkurs-selskaper som har gjenoppstått under et nytt organisasjonsnummer
select s.navn, s.orgnr as aktiv, k.orgnr as konkurs, k.etablertdato, k.oppløstdato, s.etablertdato
from selskap as s, konkurs as k
where s.navn=k.navn




## politikeres eierskap i konkursbedrifter 

select eierPersonNavn, parti, konkurs.navn
from eierskap, konkurs, politikere
where eierPersonNavn is not null and
utstederUUID = konkurs.UUID and
politikere.navn=eierPersonNavn and
extract(year from politikere.fødselsdato)=eierPersonFødselsår




## politikeres roller i  nåværende bedrifter som tidligere har gått konkurs  
select po.navn as person, po.parti as parti, ko.navn as selskap, pe.selskaprolle as rolle, 
       extract(year from pe.selskaprolleregistrerttid) as registrert
from person as pe, politikere as po, konkurs as ko
where  po.navn=pe.navn and 
       pe.fødselsår =  extract(year from po.fødselsdato) and
       pe.selskapnavn=ko.navn
order by po.navn



Finn innvalgte politikere som selger seg ut samme år, eller året før, et selskap oppløses
select e.eierPersonNavn, p.parti, k.navn, e.eierskapÅr , k.oppløstDato	
from eierskap e, konkurs k, politikere p
where e.eierPersonNavn is not null and
      k.uuid =utstederUUID and
      p.navn=e.eierPersonNavn and
	  p.innvalgt='Ja'
and extract(year from k.oppløstDato)-e.eierskapÅr <=1




Hvilken organisasjonstype har færrest konkurser?
with mintype(antall) as 
(select min(antall) from
  (select organisasjonstype, count(*) as antall
   from konkurs
   group by organisasjonstype)
   )
(
(select organisasjonstype, count(*) as antall
   from konkurs
   group by organisasjonstype
   having count(*)=(select * from mintype))
)


Hvem har  hatt roller i KAUTOKEINO VENSTRE
select navn, fødselsdato, selskaprolle, 
personselskaprollestartdato as start, personselskaprollesluttdato as slutt
from person
where selskapnavn='KAUTOKEINO VENSTRE'
order by personselskaprollestartdato




Hva er det største antallet roller noen har hatt i MEDICINERFORENINGEN
with maxrolle(antall) as
(select max(antall)
from (select navn, fødselsdato, count(selskaprolle) AS antall
      from person
      where selskapnavn='MEDICINERFORENINGEN'
      group by navn, fødselsdato)
	  )
(
select navn, fødselsdato 
from person
where selskapnavn='MEDICINERFORENINGEN'
group by navn, fødselsdato, selskapuuid
having count(selskaprolle)=(select * from maxrolle)
)



Hvor mange roller har hver politiker hatt
select po.navn, po.fødselsdato, count(*) as antall
from politikere po, person pe
where po.navn=pe.navn and po.fødselsdato=pe.fødselsdato
group by po.navn, po.fødselsdato


Hvor mange politikere har eller har hatt rolle i næringslivet de siste årene?
select count(*)
from (select po.navn as n, po.fødselsdato as f, count(*) as antall
from politikere po, person pe
where po.navn=pe.navn and po.fødselsdato=pe.fødselsdato
group by po.navn, po.fødselsdato)



Hvilke politikere har hatt roller det siste året (fra dags dato) 
##forutsetter at personselskaprollestartdato er datoen for tiltredelse i rollen,  
##>>skifte til enklere navn?

select po.navn, po.fødselsdato , personselskaprollestartdato,personselskaprollesluttdato
from politikere po, person pe
where po.navn=pe.navn and po.fødselsdato=pe.fødselsdato and
            ( personselskaprollesluttdato is null or 
	    (select current_date)-personselskaprollesluttdato < 365 or
	    (select current_date)-personselskaprollestartdato < 365)
	   




Hvor mange politikere fra partiet Rødt har hatt roller utenfor sin egen kommune
select po.navn, po.fødselsdato, count(*) as antall
from politikere po, person pe
where po.navn=pe.navn and po.fødselsdato=pe.fødselsdato and 
      po.parti='Rødt' and upper(po.kommune)<>upper(pe.kommunenavn)
group by po.navn, po.fødselsdato


